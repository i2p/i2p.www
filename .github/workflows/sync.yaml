# GitHub Actions workflow file to sync an external repository to this GitHub mirror.
# This file was automatically generated by go-github-sync.
#
# The workflow does the following:
# - Runs on a scheduled basis (and can also be triggered manually)
# - Clones the GitHub mirror repository
# - Fetches changes from the primary external repository
# - Applies those changes to the mirror repository
# - Pushes the updated content back to the GitHub mirror
#
# Authentication is handled by the GITHUB_TOKEN secret provided by GitHub Actions.

name: Mirror from Gitea to GitHub

on:
  schedule:
    - cron: "0 */6 * * *"   # every 6 hours
  workflow_dispatch: {}

permissions:
  contents: write
  workflows: write

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout GitHub mirror
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Fetch from Gitea
        run: |
          set -euo pipefail
          git remote add gitea "https://i2pgit.org/I2P_Developers/i2p.www.git"
          git fetch --prune gitea

      - name: Reset mirror branch to Gitea
        run: |
          set -euo pipefail
          git checkout master || git checkout -b master
          git reset --hard gitea/master

      - name: Push to GitHub (mirror)
        run: |
          set -euo pipefail
          git push --force-with-lease origin master
